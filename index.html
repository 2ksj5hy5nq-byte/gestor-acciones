<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestor de Acciones</title>
</head>
<body>

<h1>Gestor de Acciones</h1>

<button onclick="loginGoogle()">Iniciar sesi贸n con Google</button>
<button onclick="logout()">Cerrar sesi贸n</button>

<hr>

<h2>A帽adir acci贸n</h2>
<input id="nombre" placeholder="Nombre de la acci贸n">
<input id="precio" type="number" placeholder="Precio">
<button onclick="guardarAccion()">Guardar</button>

<hr>

<h2>Mis acciones</h2>
<ul id="lista"></ul>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { 
    getAuth, 
    GoogleAuthProvider, 
    signInWithPopup, 
    onAuthStateChanged, 
    signOut 
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  import { 
    getFirestore, 
    collection, 
    addDoc, 
    getDocs 
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  //  CONFIGURACIN FIREBASE (TUYA)
  const firebaseConfig = {
    apiKey: "AIzaSyD3XGLrrvUTNHqk8P0gU8ROeyKBApig7o",
    authDomain: "gestor-acciones.firebaseapp.com",
    projectId: "gestor-acciones",
    storageBucket: "gestor-acciones.appspot.com",
    messagingSenderId: "682376422747",
    appId: "1:682376422747:web:ec250f93ad6219eb2ce67e"
  };

  //  INIT
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  //  LOGIN
  window.loginGoogle = async () => {
    await signInWithPopup(auth, provider);
  };

  //  LOGOUT
  window.logout = async () => {
    await signOut(auth);
    document.getElementById("lista").innerHTML = "";
  };

  //  SESIN
  onAuthStateChanged(auth, user => {
    if (user) {
      cargarAcciones();
    }
  });

  //  GUARDAR ACCIN
  window.guardarAccion = async () => {
    const nombre = document.getElementById("nombre").value;
    const precio = document.getElementById("precio").value;

    if (!nombre || !precio) {
      alert("Completa todos los campos");
      return;
    }

    await addDoc(collection(db, "acciones"), {
      nombre,
      precio: Number(precio)
    });

    document.getElementById("nombre").value = "";
    document.getElementById("precio").value = "";

    cargarAcciones();
  };

  //  CARGAR ACCIONES
  async function cargarAcciones() {
    const lista = document.getElementById("lista");
    lista.innerHTML = "";

    const querySnapshot = await getDocs(collection(db, "acciones"));
    querySnapshot.forEach(doc => {
      const li = document.createElement("li");
      li.textContent = `${doc.data().nombre} - ${doc.data().precio} `;
      lista.appendChild(li);
    });
  }
</script>

</body>
</html>
