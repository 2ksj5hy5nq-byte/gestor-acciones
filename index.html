<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
  var firebaseconfig = {
    apiKey: "TU_API_KEY",
    authDomain: "gestor-acciones.firebaseapp.com",
    projectId: "gestor-acciones",
  };

  firebase.initializeApp(firebaseconfig);

  var auth = firebase.auth();
  var db = firebase.firestore();
  var uid = null;

  auth.signInAnonymously()
    .then(function (result) {
      uid = result.user.uid;
      console.log("autenticado como:", uid);
    })
    .catch(function (error) {
      alert("error de autenticación con firebase");
      console.error(error);
    });

  function guardar() {
    if (!uid) {
      alert("usuario no autenticado todavía");
      return;
    }

    var accion = document.getElementById("accion").value;
    var cantidad = Number(document.getElementById("cantidad").value);
    var precio = Number(document.getElementById("precio").value);
    var fecha = document.getElementById("fecha").value;

    db.collection("operaciones").add({
      uid: uid,
      accion: accion,
      cantidad: cantidad,
      precio: precio,
      fecha: fecha,
      created: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(function () {
      alert("guardado correctamente");
    })
    .catch(function (error) {
      alert("error al guardar");
      console.error(error);
    });
  }
</script>
