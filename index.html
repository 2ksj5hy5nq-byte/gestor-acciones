<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gestor de Acciones</title>

<style>
body{
  background:#0f172a;
  color:white;
  font-family:Arial;
  padding:15px;
}
input,button{
  width:100%;
  padding:8px;
  margin:4px 0;
  border-radius:6px;
  border:none;
}
button{
  background:#22c55e;
  font-weight:bold;
}
.card{
  background:#020617;
  padding:12px;
  border-radius:10px;
  margin-bottom:15px;
}
.row{
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.small{font-size:13px;opacity:.8}
hr{border:0;border-top:1px solid #334155;margin:10px 0}
.ganancia{color:#22c55e}
.perdida{color:#ef4444}
</style>
</head>

<body>

<h2>ğŸ“ˆ Gestor de Acciones</h2>

<div class="card">
<h3>Nueva compra</h3>
<input id="accion" placeholder="AcciÃ³n">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precioCompra" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">
<button id="btnGuardar">Guardar compra</button>
</div>

<div class="card">
<h3>ğŸ“‚ Operaciones abiertas</h3>
<div id="abiertas"></div>
</div>

<div class="card">
<h3>ğŸ“ Operaciones cerradas (por mes)</h3>
<div id="cerradas"></div>
</div>

<div class="card">
<h3>ğŸ“Š Resumen</h3>
<div id="resumen"></div>
</div>

<script>
/* ========= ESTADO ÃšNICO (NO CARPETAS) ========= */
let ops = JSON.parse(localStorage.getItem("ops")) || [];

/* ========= UTIL ========= */
const â‚¬ = n => Number(n).toFixed(2)+" â‚¬";
const save = () => localStorage.setItem("ops", JSON.stringify(ops));

/* ========= GUARDAR COMPRA (ESTABLE) ========= */
document.getElementById("btnGuardar").addEventListener("click", ()=>{
  const a = accion.value.trim();
  const c = +cantidad.value;
  const p = +precioCompra.value;
  const f = fechaCompra.value;

  if(!a||!c||!p||!f){ alert("Completa todos los campos"); return; }

  ops.push({
    id: Date.now(),
    accion:a,
    cantidad:c,
    precioCompra:p,
    fechaCompra:f,
    abierta:true,
    precioVenta:null,
    fechaVenta:null
  });

  save();
  accion.value=cantidad.value=precioCompra.value=fechaCompra.value="";
  render();
});

/* ========= CERRAR OPERACIÃ“N ========= */
function cerrar(id){
  const o = ops.find(x=>x.id===id);
  if(!o.precioVenta || !o.fechaVenta){
    alert("Introduce precio y fecha de venta");
    return;
  }
  o.abierta=false;
  save();
  render();
}

/* ========= RENDER ========= */
function render(){
  renderAbiertas();
  renderCerradas();
  renderResumen();
}

/* ========= ABIERTAS ========= */
function renderAbiertas(){
  abiertas.innerHTML="";
  ops.filter(o=>o.abierta).forEach(o=>{
    abiertas.innerHTML+=`
    <div class="row">
      <div>
        <b>${o.accion}</b><br>
        <span class="small">
          <input type="number" value="${o.cantidad}" 
            onchange="o.cantidad=+this.value;save();render()">
          Ã—
          <input type="number" step="0.01" value="${o.precioCompra}" 
            onchange="o.precioCompra=+this.value;save();render()">
        </span><br>
        <input type="date" value="${o.fechaCompra}" 
          onchange="o.fechaCompra=this.value;save()">
      </div>
      <div>
        <input type="number" step="0.01" placeholder="Precio venta"
          onchange="o.precioVenta=+this.value;save()">
        <input type="date"
          onchange="o.fechaVenta=this.value;save()">
        <button onclick="cerrar(${o.id})">Cerrar</button>
      </div>
    </div><hr>`;
  });
}

/* ========= CERRADAS (AGRUPADAS SOLO AL MOSTRAR) ========= */
function renderCerradas(){
  cerradas.innerHTML="";
  const grupos={};

  ops.filter(o=>!o.abierta).forEach(o=>{
    const mes=o.fechaVenta.slice(0,7);
    if(!grupos[mes]) grupos[mes]=[];
    grupos[mes].push(o);
  });

  Object.entries(grupos).forEach(([mes,lista])=>{
    let total=0;
    let html=`<b>${mes}</b><br>`;
    lista.forEach(o=>{
      const r=(o.precioVenta-o.precioCompra)*o.cantidad;
      total+=r;
      html+=`${o.accion}: ${â‚¬(r)}<br>`;
    });
    html+=`<b class="${total>=0?'ganancia':'perdida'}">
      Total mes: ${â‚¬(total)}</b><hr>`;
    cerradas.innerHTML+=html;
  });
}

/* ========= RESUMEN ========= */
function renderResumen(){
  let inv=0,rec=0;
  ops.forEach(o=>{
    inv+=o.cantidad*o.precioCompra;
    if(!o.abierta) rec+=o.cantidad*o.precioVenta;
  });

  resumen.innerHTML=`
    Capital invertido: ${â‚¬(inv)}<br>
    Capital recuperado: ${â‚¬(rec)}<br>
    Resultado total: ${â‚¬(rec-inv)}
  `;
}

render();
</script>

</body>
</html>
