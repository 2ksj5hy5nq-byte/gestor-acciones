<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor de Acciones</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:white;
  padding:14px
}
h2,h3,h4{margin-top:20px}
input,button,select{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button{
  border:none;
  border-radius:6px;
  font-weight:bold
}
.green{background:#22c55e;color:black}
.gray{background:#334155;color:white}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px
}
th,td{
  border-bottom:1px solid #334155;
  padding:6px;
  text-align:center;
  font-size:14px
}
.gain{color:#22c55e}
.loss{color:#ef4444}
</style>
</head>

<body>

<h2>üìà Gestor de Acciones</h2>

<!-- NUEVA COMPRA -->
<h3>‚ûï Nueva compra</h3>

<!-- ACCI√ìN CON DESPLEGABLE -->
<input id="accion" list="listaAcciones" placeholder="Acci√≥n (elige o escribe)">
<datalist id="listaAcciones"></datalist>

<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precioCompra" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">

<button class="green" onclick="guardarCompra()">Guardar compra</button>

<!-- ABIERTAS -->
<h3>üìÇ Operaciones abiertas</h3>
<table>
<thead>
<tr>
<th>Acci√≥n</th><th>Cant.</th><th>Compra</th><th>Total</th><th>Fecha</th><th>Cerrar</th>
</tr>
</thead>
<tbody id="tablaAbiertas"></tbody>
</table>

<script>
let abiertas = JSON.parse(localStorage.getItem("abiertas")) || [];
let acciones = JSON.parse(localStorage.getItem("acciones")) || [];

// ===== GUARDAR COMPRA =====
function guardarCompra(){
  const nombre = accion.value.trim().toUpperCase();

  if(!nombre || !cantidad.value || !precioCompra.value || !fechaCompra.value){
    alert("Completa todos los campos"); 
    return;
  }

  // Guardar acci√≥n si es nueva
  if(!acciones.includes(nombre)){
    acciones.push(nombre);
    acciones.sort();
    localStorage.setItem("acciones", JSON.stringify(acciones));
    pintarListaAcciones();
  }

  abiertas.push({
    accion: nombre,
    cantidad: +cantidad.value,
    compra: +precioCompra.value,
    fechaCompra: fechaCompra.value
  });

  guardar();
  accion.value = cantidad.value = precioCompra.value = fechaCompra.value = "";
  pintarAbiertas();
}

// ===== LISTA ACCIONES =====
function pintarListaAcciones(){
  listaAcciones.innerHTML = "";
  acciones.forEach(a=>{
    listaAcciones.innerHTML += `<option value="${a}">`;
  });
}

// ===== ABIERTAS =====
function pintarAbiertas(){
  tablaAbiertas.innerHTML = "";
  abiertas.forEach((o,i)=>{
    tablaAbiertas.innerHTML += `
    <tr>
      <td>${o.accion}</td>
      <td>${o.cantidad}</td>
      <td>${o.compra}</td>
      <td>${(o.cantidad*o.compra).toFixed(2)} ‚Ç¨</td>
      <td>${o.fechaCompra}</td>
      <td>
        <input id="pv_${i}" type="number" placeholder="Venta">
        <input id="fv_${i}" type="date">
        <button class="gray" onclick="cerrarOperacion(${i})">Cerrar</button>
      </td>
    </tr>`;
  });
}

// ===== CERRAR (B√ÅSICO) =====
function cerrarOperacion(i){
  if(!confirm("¬øCerrar esta operaci√≥n?")) return;
  abiertas.splice(i,1);
  guardar();
  pintarAbiertas();
}

// ===== STORAGE =====
function guardar(){
  localStorage.setItem("abiertas", JSON.stringify(abiertas));
}

const tablaAbiertas = document.getElementById("tablaAbiertas");
const listaAcciones = document.getElementById("listaAcciones");

pintarListaAcciones();
pintarAbiertas();
</script>

</body>
</html>
