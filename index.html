<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gestor de Acciones</title>

<style>
body{background:#0f172a;color:white;font-family:Arial;padding:15px}
input,button,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#22c55e;color:black;font-weight:bold}
.card{background:#020617;padding:12px;border-radius:10px;margin-bottom:15px}
.box{border:1px solid #334155;border-radius:8px;padding:10px;margin-bottom:12px}
hr{border:0;border-top:1px solid #334155;margin:10px 0}
.ganancia{color:#22c55e;font-weight:bold}
.perdida{color:#ef4444;font-weight:bold}
.total{text-align:center;font-size:18px;margin:10px 0}
.small{opacity:.85;font-size:14px}
</style>
</head>

<body>

<h2>üìà Gestor de Acciones</h2>

<div class="card">
<h3>Nueva compra</h3>
<input id="accion" placeholder="Nombre">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precio" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">
<button onclick="guardarCompra()">Guardar compra</button>
</div>

<div class="card">
<h3>üìÇ Operaciones abiertas</h3>
<div id="abiertas"></div>
</div>

<div class="card">
<h3>üìÅ Operaciones cerradas</h3>
<select id="filtroMes" onchange="renderCerradas()">
<option value="">‚Äî Todos los meses ‚Äî</option>
</select>
<div class="total" id="totalFiltrado"></div>
<div id="cerradas"></div>
</div>

<div class="card">
<h3>üìä Resumen</h3>
<div id="resumen"></div>
</div>

<script>
let operaciones = JSON.parse(localStorage.getItem("ops")) || [];

function guardarEstado(){
  localStorage.setItem("ops",JSON.stringify(operaciones));
}

function guardarCompra(){
  const a=accion.value.trim();
  const c=Number(cantidad.value);
  const p=Number(precio.value);
  const f=fechaCompra.value;
  if(!a||!c||!p||!f){alert("Completa todos los datos");return;}
  operaciones.push({
    id:Date.now(),
    accion:a,
    cantidad:c,
    precioCompra:p,
    fechaCompra:f,
    abierta:true
  });
  guardarEstado();render();
}

function cerrarOperacion(id){
  const pv=Number(prompt("Precio venta"));
  const fv=prompt("Fecha venta (YYYY-MM-DD)");
  if(!pv||!fv)return;
  const o=operaciones.find(x=>x.id===id);
  o.precioVenta=pv;
  o.fechaVenta=fv;
  o.abierta=false;
  guardarEstado();render();
}

function operacionValida(o){
  return o && !o.abierta &&
    typeof o.cantidad==="number" &&
    typeof o.precioCompra==="number" &&
    typeof o.precioVenta==="number" &&
    o.fechaCompra && o.fechaVenta;
}

function render(){
  renderAbiertas();
  renderFiltroMes();
  renderCerradas();
  renderResumen();
}

function renderAbiertas(){
  abiertas.innerHTML="";
  operaciones.filter(o=>o.abierta).forEach(o=>{
    const inv=o.cantidad*o.precioCompra;
    abiertas.innerHTML+=`
    <div class="box">
      <strong>${o.accion}</strong><br>
      <span class="small">${o.fechaCompra}</span><br>
      <span class="small">${o.cantidad} √ó ${o.precioCompra} ‚Ç¨ = ${inv.toFixed(2)} ‚Ç¨</span>
      <hr>
      <button onclick="cerrarOperacion(${o.id})">Cerrar</button>
    </div>`;
  });
}

function renderFiltroMes(){
  const meses=[...new Set(
    operaciones.filter(operacionValida)
      .map(o=>o.fechaVenta.slice(0,7))
  )];
  filtroMes.innerHTML='<option value="">‚Äî Todos los meses ‚Äî</option>';
  meses.forEach(m=>filtroMes.innerHTML+=`<option>${m}</option>`);
}

function renderCerradas(){
  cerradas.innerHTML="";
  let total=0;
  operaciones.filter(operacionValida)
    .filter(o=>!filtroMes.value || o.fechaVenta.startsWith(filtroMes.value))
    .forEach(o=>{
      const inv=o.cantidad*o.precioCompra;
      const rec=o.cantidad*o.precioVenta;
      const res=rec-inv;
      total+=res;
      cerradas.innerHTML+=`
      <div class="box">
        <strong>${o.accion}</strong><br><br>

        <div class="small">
          ${o.fechaCompra}<br>
          ${o.cantidad} √ó ${o.precioCompra} ‚Ç¨ = ${inv.toFixed(2)} ‚Ç¨
        </div>

        <hr>

        <div class="small">
          ${o.fechaVenta}<br>
          ${o.cantidad} √ó ${o.precioVenta} ‚Ç¨ = ${rec.toFixed(2)} ‚Ç¨
        </div>

        <hr>

        <div class="${res>=0?'ganancia':'perdida'}">
          ${res>=0?'+':''}${res.toFixed(2)} ‚Ç¨
        </div>
      </div>`;
    });
  totalFiltrado.innerHTML=`TOTAL MES: ${total.toFixed(2)} ‚Ç¨`;
}

function renderResumen(){
  let inv=0,rec=0;
  operaciones.forEach(o=>{
    inv+=o.cantidad*o.precioCompra;
    if(!o.abierta && operacionValida(o)){
      rec+=o.cantidad*o.precioVenta;
    }
  });
  resumen.innerHTML=`
    Capital invertido: ${inv.toFixed(2)} ‚Ç¨<br>
    Capital recuperado: ${rec.toFixed(2)} ‚Ç¨<br>
    Resultado total: ${(rec-inv).toFixed(2)} ‚Ç¨
  `;
}

render();
</script>

</body>
</html>
