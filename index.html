<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor de Acciones</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
  padding: 20px;
}
input, button {
  padding: 8px;
  margin: 5px;
}
button {
  font-weight: bold;
}
</style>
</head>

<body>

<h2>üìà Gestor de Acciones</h2>

<input id="accion" placeholder="Acci√≥n (ej: AAPL)">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precio" type="number" step="0.01" placeholder="Precio">
<input id="fecha" type="date">
<br>
<button onclick="guardar()">Guardar compra</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyD3XGLrrvUTNHHqk8P0gU8ROeyKBapig7o",
  authDomain: "gestor-acciones.firebaseapp.com",
  projectId: "gestor-acciones",
  storageBucket: "gestor-acciones.appspot.com",
  messagingSenderId: "682376422747",
  appId: "1:682376422747:web:ec250f93ad6219eb2ce67e"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let uid = null;

/* ================= LOGIN AN√ìNIMO FORZADO ================= */
auth.onAuthStateChanged(user => {
  if (user) {
    uid = user.uid;
    console.log("‚úÖ Usuario autenticado:", uid);
  } else {
    auth.signInAnonymously()
      .then(() => console.log("üîê Login an√≥nimo iniciado"))
      .catch(err => {
        alert("‚ùå Error de autenticaci√≥n con Firebase");
        console.error(err);
      });
  }
});

/* ================= GUARDAR ================= */
function guardar() {
  if (!uid) {
    alert("‚è≥ Espera un segundo, autenticando‚Ä¶");
    return;
  }

  const accion = accionInput.value.trim();
  const cantidad = Number(cantidadInput.value);
  const precio = Number(precioInput.value);
  const fecha = fechaInput.value;

  if (!accion || !cantidad || !precio || !fecha) {
    alert("‚ö†Ô∏è Completa todos los campos");
    return;
  }

  db.collection("operaciones").add({
    uid,
    accion,
    cantidad,
    precio,
    fecha,
    creada: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    alert("‚úÖ Guardado correctamente");
  })
  .catch(err => {
    alert("‚ùå Error al guardar");
    console.error(err);
  });
}

/* ================= INPUTS ================= */
const accionInput = document.getElementById("accion");
const cantidadInput = document.getElementById("cantidad");
const precioInput = document.getElementById("precio");
const fechaInput = document.getElementById("fecha");
</script>

</body>
</html>
