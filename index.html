<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gestor de Acciones</title>

<style>
body{
  background:#0f172a;
  color:white;
  font-family:Arial;
  padding:15px;
}
input,button{
  width:100%;
  padding:8px;
  margin:4px 0;
  border-radius:6px;
  border:none;
}
button{
  background:#22c55e;
  font-weight:bold;
}
.card{
  background:#020617;
  padding:12px;
  border-radius:10px;
  margin-bottom:15px;
}
.row{
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.small{font-size:13px;opacity:.8}
hr{border:0;border-top:1px solid #334155;margin:10px 0}
.mes{background:#020617;padding:10px;border-radius:8px;margin-bottom:10px}
.ganancia{color:#22c55e}
.perdida{color:#ef4444}
</style>
</head>

<body>

<h2>ğŸ“ˆ Gestor de Acciones</h2>

<div class="card">
<h3>Nueva compra</h3>
<input id="accion" placeholder="AcciÃ³n">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precioCompra" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">
<button id="guardar">Guardar compra</button>
</div>

<div class="card">
<h3>ğŸ“‚ Operaciones abiertas</h3>
<div id="abiertas"></div>
</div>

<div class="card">
<h3>ğŸ“ Cerradas por mes</h3>
<div id="cerradas"></div>
</div>

<div class="card">
<h3>ğŸ“Š Resumen</h3>
<div id="resumen"></div>
</div>

<script>
let ops = JSON.parse(localStorage.getItem("ops")) || [];

const â‚¬ = n => Number(n).toFixed(2)+" â‚¬";

const guardarEstado=()=>localStorage.setItem("ops",JSON.stringify(ops));

document.getElementById("guardar").addEventListener("click",()=>{
  const a=accion.value.trim();
  const c=+cantidad.value;
  const p=+precioCompra.value;
  const f=fechaCompra.value;
  if(!a||!c||!p||!f){alert("Completa todos los campos");return;}
  ops.push({
    id:Date.now(),
    accion:a,
    cantidad:c,
    precioCompra:p,
    fechaCompra:f,
    abierta:true,
    precioVenta:null,
    fechaVenta:null
  });
  guardarEstado();
  accion.value=cantidad.value=precioCompra.value=fechaCompra.value="";
  render();
});

function cerrar(id){
  const o=ops.find(x=>x.id===id);
  o.abierta=false;
  guardarEstado();
  render();
}

function render(){
  renderAbiertas();
  renderCerradas();
  renderResumen();
}

function renderAbiertas(){
  abiertas.innerHTML="";
  ops.filter(o=>o.abierta).forEach(o=>{
    abiertas.innerHTML+=`
    <div class="row">
      <div>
        <b>${o.accion}</b><br>
        <span class="small">
          <input type="number" value="${o.cantidad}" onchange="oCantidad(${o.id},this.value)">
          Ã—
          <input type="number" step="0.01" value="${o.precioCompra}" onchange="oPrecioCompra(${o.id},this.value)">
        </span><br>
        <input type="date" value="${o.fechaCompra}" onchange="oFechaCompra(${o.id},this.value)">
      </div>
      <div>
        <input type="number" step="0.01" placeholder="Precio venta" onchange="oPrecioVenta(${o.id},this.value)">
        <input type="date" onchange="oFechaVenta(${o.id},this.value)">
        <button onclick="cerrar(${o.id})">Cerrar</button>
      </div>
    </div><hr>`;
  });
}

function renderCerradas(){
  cerradas.innerHTML="";
  const grupos={};
  ops.filter(o=>!o.abierta).forEach(o=>{
    const m=o.fechaVenta.slice(0,7);
    grupos[m]=grupos[m]||[];
    grupos[m].push(o);
  });

  Object.entries(grupos).forEach(([mes,lista])=>{
    let total=0;
    let html=`<div class="mes"><b>${mes}</b><br>`;
    lista.forEach(o=>{
      const r=(o.precioVenta-o.precioCompra)*o.cantidad;
      total+=r;
      html+=`${o.accion}: ${â‚¬(r)}<br>`;
    });
    html+=`<b class="${total>=0?'ganancia':'perdida'}">Total mes: ${â‚¬(total)}</b></div>`;
    cerradas.innerHTML+=html;
  });
}

function renderResumen(){
  let inv=0,rec=0;
  ops.forEach(o=>{
    inv+=o.cantidad*o.precioCompra;
    if(!o.abierta)rec+=o.cantidad*o.precioVenta;
  });
  resumen.innerHTML=`
    Capital invertido: ${â‚¬(inv)}<br>
    Capital recuperado: ${â‚¬(rec)}<br>
    Resultado total: ${â‚¬(rec-inv)}
  `;
}

function oCantidad(id,v){ops.find(o=>o.id===id).cantidad=+v;guardarEstado();render();}
function oPrecioCompra(id,v){ops.find(o=>o.id===id).precioCompra=+v;guardarEstado();render();}
function oFechaCompra(id,v){ops.find(o=>o.id===id).fechaCompra=v;guardarEstado();}
function oPrecioVenta(id,v){ops.find(o=>o.id===id).precioVenta=+v;guardarEstado();}
function oFechaVenta(id,v){ops.find(o=>o.id===id).fechaVenta=v;guardarEstado();}

render();
</script>

</body>
</html>
