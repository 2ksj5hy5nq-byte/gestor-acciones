<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestor de Acciones</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    h1 {
      margin-bottom: 10px;
    }
    button {
      padding: 6px 12px;
      margin: 5px 0;
      cursor: pointer;
    }
    input, select {
      padding: 6px;
      margin-right: 5px;
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
    }
  </style>
</head>
<body>

<h1>Gestor de Acciones</h1>

<div id="login">
  <p>Inicia sesi√≥n con Google para continuar</p>
  <button id="loginBtn">Iniciar sesi√≥n con Google</button>
</div>

<div id="app" style="display:none;">
  <button id="logoutBtn">Cerrar sesi√≥n</button>

  <h3>Usuario</h3>
  <pre id="userData"></pre>

  <h3>Nueva acci√≥n</h3>
  <select id="tipo">
    <option value="Compra">Compra</option>
    <option value="Venta">Venta</option>
  </select>
  <input type="number" id="importe" placeholder="Importe ‚Ç¨">
  <button id="guardarBtn">Guardar acci√≥n</button>

  <h3>Mis acciones</h3>
  <ul id="listaAcciones"></ul>

  <h3>Resumen</h3>
  <p id="resumen"></p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    GoogleAuthProvider,
    signInWithPopup,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    query,
    where,
    onSnapshot,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // üî¥ CONFIGURACI√ìN FIREBASE (usa la tuya)
  const firebaseConfig = {
    apiKey: "AIzaSyD3XGLrrvUTNHHqk8P0gU8ROeyKBApig7o",
    authDomain: "gestor-acciones.firebaseapp.com",
    projectId: "gestor-acciones",
    storageBucket: "gestor-acciones.appspot.com",
    messagingSenderId: "682376422747",
    appId: "1:682376422747:web:ec250f93ad6219eb2ce67e"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const loginDiv = document.getElementById("login");
  const appDiv = document.getElementById("app");
  const userData = document.getElementById("userData");
  const listaAcciones = document.getElementById("listaAcciones");
  const resumen = document.getElementById("resumen");

  document.getElementById("loginBtn").onclick = async () => {
    await signInWithPopup(auth, provider);
  };

  document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
  };

  document.getElementById("guardarBtn").onclick = async () => {
    const tipo = document.getElementById("tipo").value;
    const importe = Number(document.getElementById("importe").value);
    const user = auth.currentUser;

    if (!importe || importe <= 0) {
      alert("Introduce un importe v√°lido");
      return;
    }

    await addDoc(collection(db, "acciones"), {
      uid: user.uid,
      tipo,
      importe,
      fecha: serverTimestamp()
    });

    document.getElementById("importe").value = "";
  };

  onAuthStateChanged(auth, (user) => {
    if (!user) {
      loginDiv.style.display = "block";
      appDiv.style.display = "none";
      return;
    }

    loginDiv.style.display = "none";
    appDiv.style.display = "block";

    userData.textContent = JSON.stringify({
      uid: user.uid,
      email: user.email,
      nombre: user.displayName
    }, null, 2);

    const q = query(
      collection(db, "acciones"),
      where("uid", "==", user.uid)
    );

    onSnapshot(q, (snap) => {
      listaAcciones.innerHTML = "";
      let total = 0;

      snap.forEach(doc => {
        const a = doc.data();
        const signo = a.tipo === "Compra" ? -1 : 1;
        total += signo * a.importe;

        const li = document.createElement("li");
        li.textContent = `${a.tipo} ‚Äî ${a.importe} ‚Ç¨`;
        listaAcciones.appendChild(li);
      });

      resumen.textContent = `Resultado total: ${total.toFixed(2)} ‚Ç¨`;
    });
  });
</script>

</body>
</html>
