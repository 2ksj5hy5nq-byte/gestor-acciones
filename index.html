<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor de Acciones</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:white;
  padding:14px
}
h2,h3,h4{margin-top:20px}
input,button,select{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button{
  border:none;
  border-radius:6px;
  font-weight:bold
}
.green{background:#22c55e;color:black}
.gray{background:#334155;color:white}
.blue{background:#2563eb;color:white}
.red{background:#ef4444;color:white}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px
}
th,td{
  border-bottom:1px solid #334155;
  padding:6px;
  text-align:center;
  font-size:14px
}
.gain{color:#22c55e}
.loss{color:#ef4444}
.totalBox{
  background:#020617;
  padding:10px;
  border-radius:8px;
  margin-top:10px;
  font-size:18px;
  font-weight:bold;
  text-align:center
}
</style>
</head>

<body>

<h2>ğŸ“ˆ Gestor de Acciones</h2>

<div id="totalGlobal" class="totalBox">Total global: 0 â‚¬</div>

<!-- ORDEN ABIERTAS -->
<h3>â†•ï¸ Ordenar abiertas</h3>
<select id="ordenAbiertas" onchange="pintarAbiertas()">
  <option value="fecha">ğŸ“… Fecha de compra</option>
  <option value="accion">ğŸ”¤ Nombre acciÃ³n</option>
  <option value="importe">ğŸ’° Importe invertido</option>
</select>

<!-- NUEVA COMPRA -->
<h3>â• Nueva compra</h3>
<input id="accion" placeholder="AcciÃ³n">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precioCompra" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">
<button class="green" onclick="guardarCompra()">Guardar compra</button>

<!-- ABIERTAS -->
<h3>ğŸ“‚ Operaciones abiertas</h3>
<table>
<thead>
<tr>
<th>AcciÃ³n</th><th>Cant.</th><th>Compra</th><th>Total</th><th>Fecha</th><th>Cerrar</th>
</tr>
</thead>
<tbody id="tablaAbiertas"></tbody>
</table>

<script>
let abiertas = JSON.parse(localStorage.getItem("abiertas")) || [];

// ===== COMPRAS =====
function guardarCompra(){
  if(!accion.value||!cantidad.value||!precioCompra.value||!fechaCompra.value){
    alert("Completa todos los campos"); return;
  }
  abiertas.push({
    accion: accion.value.toUpperCase(),
    cantidad:+cantidad.value,
    compra:+precioCompra.value,
    fechaCompra:fechaCompra.value
  });
  guardar();
  accion.value=cantidad.value=precioCompra.value=fechaCompra.value="";
  pintarAbiertas();
}

// ===== ORDENAR ABIERTAS =====
function ordenarAbiertas(){
  const modo = document.getElementById("ordenAbiertas").value;

  if(modo==="accion"){
    abiertas.sort((a,b)=>a.accion.localeCompare(b.accion));
  }
  if(modo==="fecha"){
    abiertas.sort((a,b)=>a.fechaCompra.localeCompare(b.fechaCompra));
  }
  if(modo==="importe"){
    abiertas.sort((a,b)=>
      (b.cantidad*b.compra)-(a.cantidad*a.compra)
    );
  }
}

// ===== PINTAR =====
function pintarAbiertas(){
  ordenarAbiertas();
  tablaAbiertas.innerHTML="";
  abiertas.forEach((o,i)=>{
    const total = (o.cantidad*o.compra).toFixed(2);
    tablaAbiertas.innerHTML+=`
      <tr>
        <td>${o.accion}</td>
        <td>${o.cantidad}</td>
        <td>${o.compra}</td>
        <td>${total} â‚¬</td>
        <td>${o.fechaCompra}</td>
        <td>
          <input id="pv_${i}" type="number" step="0.01" placeholder="Venta">
          <input id="fv_${i}" type="date">
          <button class="gray" onclick="cerrarOperacion(${i})">Cerrar</button>
        </td>
      </tr>`;
  });
}

// ===== CIERRE (BÃSICO) =====
function cerrarOperacion(i){
  if(!confirm("Â¿Cerrar esta operaciÃ³n?")) return;
  abiertas.splice(i,1);
  guardar();
  pintarAbiertas();
}

// ===== STORAGE =====
function guardar(){
  localStorage.setItem("abiertas",JSON.stringify(abiertas));
}

const tablaAbiertas=document.getElementById("tablaAbiertas");
pintarAbiertas();
</script>

</body>
</html>
