<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor de Acciones</title>

<style>
body{font-family:Arial;background:#0f172a;color:white;padding:15px}
input,button{padding:6px;margin:4px}
button{font-weight:bold}
.bloque{border:1px solid #334155;border-radius:8px;padding:10px;margin-top:10px}
.oculto{display:none}
</style>
</head>

<body>

<h2>ğŸ“ˆ Gestor de Acciones</h2>

<h3>Guardar compra</h3>

<input id="accion" placeholder="AcciÃ³n">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precioCompra" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">
<br>
<button onclick="guardar()">Guardar compra</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”¥ Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyD3XGLrrvUTNHHqk8P0gU8ROeyKBapig7o",
  authDomain: "gestor-acciones.firebaseapp.com",
  projectId: "gestor-acciones",
  storageBucket: "gestor-acciones.firebasestorage.app",
  messagingSenderId: "682376422747",
  appId: "1:682376422747:web:ec250f93ad6219eb2ce67e"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let uid = null;

auth.signInAnonymously().catch(console.error);

auth.onAuthStateChanged(user=>{
  if(user){
    uid = user.uid;
    console.log("Firebase conectado:", uid);
  }
});

/* ğŸ’¾ Guardar operaciÃ³n */
function guardar(){
  const accion = document.getElementById("accion").value.trim();
  const cantidad = Number(document.getElementById("cantidad").value);
  const precio = Number(document.getElementById("precioCompra").value);
  const fecha = document.getElementById("fechaCompra").value;

  if(!accion || !cantidad || !precio || !fecha){
    alert("âš ï¸ Completa todos los campos");
    return;
  }

  db.collection("operaciones").add({
    uid,
    accion,
    cantidad,
    precio,
    total: cantidad * precio,
    fecha,
    creada: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(()=>{
    alert("âœ… OperaciÃ³n guardada en la nube");
    document.getElementById("accion").value="";
    document.getElementById("cantidad").value="";
    document.getElementById("precioCompra").value="";
    document.getElementById("fechaCompra").value="";
  })
  .catch(err=>{
    alert("âŒ Error al guardar");
    console.error(err);
  });
}
</script>

</body>
</html>
