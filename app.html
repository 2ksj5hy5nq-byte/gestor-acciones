<script>
let uid = null;

function guardar() {
  const accion = document.getElementById("accion").value.trim();
  const cantidad = Number(document.getElementById("cantidad").value);
  const precio = Number(document.getElementById("precioCompra").value);
  const fecha = document.getElementById("fechaCompra").value;

  if (!accion || !cantidad || !precio || !fecha) {
    alert("⚠️ Completa todos los campos");
    return;
  }

  db.collection("operaciones").add({
    uid: uid,
    accion: accion,
    cantidad: cantidad,
    precioCompra: precio,
    totalCompra: cantidad * precio,
    fechaCompra: fecha,
    creada: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    alert("✅ Operación guardada");
  })
  .catch(err => {
    alert("❌ Error al guardar");
    console.error("Firestore error:", err);
  });
}
</script>
