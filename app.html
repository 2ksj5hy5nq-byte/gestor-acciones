<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor de Acciones</title>
<style>
body{font-family:Arial;background:#0f172a;color:white;padding:15px}
input,button{padding:6px;margin:4px}
button{font-weight:bold}
.bloque{border:1px solid #334155;border-radius:8px;padding:10px;margin-top:12px}
.abierta{opacity:0.9}
.ganancia{color:#22c55e;font-weight:bold}
.perdida{color:#ef4444;font-weight:bold}
.total{font-size:18px;margin:10px 0}
</style>
</head>

<body>
<h2>üìà Gestor de Acciones</h2>

<div id="total" class="total"></div>

<input id="accion" placeholder="Acci√≥n (ej: AAPL)">
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="precio" type="number" step="0.01" placeholder="Precio compra">
<input id="fechaCompra" type="date">
<button onclick="guardarCompra()">Guardar compra</button>

<hr>
<h3>üì¶ Operaciones</h3>
<div id="lista"></div>

<script>
let operaciones = JSON.parse(localStorage.getItem("operaciones")) || [];

function guardarLocal(){
  localStorage.setItem("operaciones", JSON.stringify(operaciones));
}

function guardarCompra(){
  const a = accion.value.trim().toUpperCase();
  const n = Number(cantidad.value);
  const p = Number(precio.value);
  const f = fechaCompra.value;

  if(!a || !n || !p || !f){
    alert("Completa todos los campos");
    return;
  }

  operaciones.push({
    accion:a,
    cantidad:n,
    compra:p,
    fechaCompra:f,
    venta:null,
    fechaVenta:null,
    resultado:0,
    estado:"abierta"
  });

  guardarLocal();
  limpiar();
  pintar();
}

function cerrarOperacion(i){
  const precioVenta = Number(document.getElementById("venta_"+i).value);
  const fechaVenta = document.getElementById("fechaVenta_"+i).value;

  if(!precioVenta || !fechaVenta){
    alert("Introduce precio y fecha de venta");
    return;
  }

  const o = operaciones[i];
  o.venta = precioVenta;
  o.fechaVenta = fechaVenta;
  o.resultado = (o.venta - o.compra) * o.cantidad;
  o.estado = "cerrada";

  guardarLocal();
  pintar();
}

function borrarOperacion(i){
  if(confirm("¬øBorrar esta operaci√≥n?")){
    operaciones.splice(i,1);
    guardarLocal();
    pintar();
  }
}

function calcularTotal(){
  return operaciones
    .filter(o=>o.estado==="cerrada")
    .reduce((s,o)=>s+o.resultado,0);
}

function pintar(){
  lista.innerHTML = "";

  operaciones.forEach((o,i)=>{
    if(o.estado==="abierta"){
      lista.innerHTML += `
        <div class="bloque abierta">
          <strong>${o.accion}</strong><br>
          Compra: ${o.cantidad} √ó ${o.compra} ‚Ç¨<br>
          Fecha compra: ${o.fechaCompra}<br>
          <input id="venta_${i}" type="number" step="0.01" placeholder="Precio de venta">
          <input id="fechaVenta_${i}" type="date">
          <button onclick="cerrarOperacion(${i})">Cerrar operaci√≥n</button>
        </div>`;
    } else {
      lista.innerHTML += `
        <div class="bloque">
          <strong>${o.accion}</strong><br>
          Compra: ${o.cantidad} √ó ${o.compra} ‚Ç¨ (${o.fechaCompra})<br>
          Venta: ${o.cantidad} √ó ${o.venta} ‚Ç¨ (${o.fechaVenta})<br>
          Resultado:
          <span class="${o.resultado>=0?'ganancia':'perdida'}">
            ${o.resultado.toFixed(2)} ‚Ç¨
          </span><br>
          <button onclick="borrarOperacion(${i})">üóëÔ∏è Borrar</button>
        </div>`;
    }
  });

  const total = calcularTotal();
  document.getElementById("total").innerHTML =
    `üí∞ Ganancia total: 
     <span class="${total>=0?'ganancia':'perdida'}">
       ${total.toFixed(2)} ‚Ç¨
     </span>`;
}

function limpiar(){
  accion.value="";
  cantidad.value="";
  precio.value="";
  fechaCompra.value="";
}

pintar();
</script>

</body>
</html>
